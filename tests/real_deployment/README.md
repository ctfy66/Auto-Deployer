# çœŸå®éƒ¨ç½²æµ‹è¯•å¥—ä»¶

è¿™æ˜¯Auto-Deployerçš„çœŸå®éƒ¨ç½²æµ‹è¯•å¥—ä»¶ï¼Œä½¿ç”¨çœŸå®LLMå’ŒDockerå®¹å™¨ç¯å¢ƒæ¥æµ‹è¯•Agentçš„éƒ¨ç½²èƒ½åŠ›ã€‚

## æ¦‚è¿°

æœ¬æµ‹è¯•å¥—ä»¶é€šè¿‡ä»¥ä¸‹æ–¹å¼è¯„ä¼°Agentï¼š

1. **çœŸå®LLMæµ‹è¯•**ï¼šä½¿ç”¨çœŸå®çš„Gemini/OpenAI APIï¼Œæµ‹è¯•Agentçš„æ™ºèƒ½å†³ç­–èƒ½åŠ›
2. **Dockeréš”ç¦»ç¯å¢ƒ**ï¼šä½¿ç”¨Dockerå®¹å™¨ä½œä¸ºæµ‹è¯•ç›®æ ‡ï¼Œæä¾›å¹²å‡€ã€å¯é‡å¤çš„æµ‹è¯•ç¯å¢ƒ
3. **ä»£è¡¨æ€§é¡¹ç›®**ï¼šä½¿ç”¨å¤šä¸ªä¸åŒç±»å‹çš„é¡¹ç›®ï¼ˆNode.jsã€Pythonã€Dockerç­‰ï¼‰è¿›è¡Œæµ‹è¯•
4. **é‡åŒ–æŒ‡æ ‡**ï¼šæ”¶é›†æˆåŠŸç‡ã€è€—æ—¶ã€è¿­ä»£æ¬¡æ•°ç­‰å¯é‡åŒ–çš„æŒ‡æ ‡

## å‰ç½®è¦æ±‚

### 1. Docker

ç¡®ä¿Dockerå·²å®‰è£…å¹¶è¿è¡Œï¼š

```bash
# æ£€æŸ¥Docker
docker --version
docker ps
```

### 2. Pythonä¾èµ–

ç¡®ä¿å·²å®‰è£…é¡¹ç›®ä¾èµ–ï¼š

```bash
pip install -e .
```

è¿˜éœ€è¦å®‰è£…Docker Pythonåº“ï¼š

```bash
pip install docker requests
```

### 3. APIå¯†é’¥

è®¾ç½®LLM APIå¯†é’¥ï¼š

```bash
# Gemini
export AUTO_DEPLOYER_GEMINI_API_KEY=your-key

# æˆ– OpenAI
export AUTO_DEPLOYER_OPENAI_API_KEY=your-key
```

### 4. æµ‹è¯•é¡¹ç›®ä»“åº“

**é‡è¦**ï¼š`test_projects.py`ä¸­çš„ä»“åº“URLéœ€è¦æ›¿æ¢ä¸ºçœŸå®çš„æµ‹è¯•ä»“åº“ã€‚

å½“å‰é…ç½®çš„ä»“åº“URLæ˜¯ç¤ºä¾‹ï¼Œéœ€è¦ï¼š

1. åˆ›å»ºæµ‹è¯•é¡¹ç›®ä»“åº“ï¼ˆæˆ–ä½¿ç”¨ç°æœ‰é¡¹ç›®ï¼‰
2. æ›´æ–°`test_projects.py`ä¸­çš„`repo_url`å­—æ®µ

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ç”¨æ³•

è¿è¡Œæ‰€æœ‰æµ‹è¯•é¡¹ç›®ï¼š

**Windowsï¼ˆæ¨èä½¿ç”¨ Python Launcherï¼‰**ï¼š
```powershell
py -3.12 -m tests.run_tests
```

æˆ–ä½¿ç”¨ä¾¿æ·è„šæœ¬ï¼š
```powershell
.\run_tests.ps1
```

**Linux/Mac**ï¼š
```bash
python -m tests.run_tests
```

æˆ–ç›´æ¥è¿è¡Œï¼š

```bash
python -m tests.real_deployment.test_suite
```

> **æ³¨æ„**ï¼šå¦‚æœé‡åˆ° `ModuleNotFoundError`ï¼Œè¯·å‚è€ƒ [æ•…éšœæ’æŸ¥æŒ‡å—](../docs/troubleshooting.md) ä¸­çš„"Python ç¯å¢ƒä¸ä¸€è‡´é—®é¢˜"éƒ¨åˆ†ã€‚

### å‘½ä»¤è¡Œé€‰é¡¹

**Windows**ï¼š
```powershell
# åªæµ‹è¯•æŒ‡å®šé¡¹ç›®
py -3.12 -m tests.run_tests --project docker-welcome

# åªæµ‹è¯•æŒ‡å®šéš¾åº¦
py -3.12 -m tests.run_tests --difficulty easy

# ä½¿ç”¨è‡ªå®šä¹‰é…ç½®æ–‡ä»¶
py -3.12 -m tests.run_tests --config config/my_config.json

# è·³è¿‡ç¯å¢ƒè®¾ç½®ï¼ˆè°ƒè¯•æ¨¡å¼ï¼Œéœ€è¦æ‰‹åŠ¨æä¾›ç¯å¢ƒï¼‰
py -3.12 -m tests.run_tests --skip-setup
```

**Linux/Mac**ï¼š
```bash
# åªæµ‹è¯•æŒ‡å®šé¡¹ç›®
python -m tests.run_tests --project docker-welcome

# åªæµ‹è¯•æŒ‡å®šéš¾åº¦
python -m tests.run_tests --difficulty easy

# ä½¿ç”¨è‡ªå®šä¹‰é…ç½®æ–‡ä»¶
python -m tests.run_tests --config config/my_config.json

# è·³è¿‡ç¯å¢ƒè®¾ç½®ï¼ˆè°ƒè¯•æ¨¡å¼ï¼Œéœ€è¦æ‰‹åŠ¨æä¾›ç¯å¢ƒï¼‰
python -m tests.run_tests --skip-setup
```

### æµ‹è¯•é¡¹ç›®é…ç½®

æµ‹è¯•é¡¹ç›®åœ¨`test_projects.py`ä¸­å®šä¹‰ã€‚æ¯ä¸ªé¡¹ç›®åŒ…å«ï¼š

- `name`: é¡¹ç›®åç§°ï¼ˆå”¯ä¸€æ ‡è¯†ï¼‰
- `repo_url`: Gitä»“åº“URL
- `description`: é¡¹ç›®æè¿°
- `expected_strategy`: æœŸæœ›çš„éƒ¨ç½²ç­–ç•¥
- `difficulty`: éš¾åº¦ï¼ˆeasy/medium/hardï¼‰
- `verification`: éªŒè¯é…ç½®ï¼ˆURLã€çŠ¶æ€ç ç­‰ï¼‰

### æ·»åŠ æ–°æµ‹è¯•é¡¹ç›®

åœ¨`test_projects.py`çš„`TEST_PROJECTS`åˆ—è¡¨ä¸­æ·»åŠ ï¼š

```python
TestProject(
    name="my-new-project",
    repo_url="https://github.com/user/repo.git",
    description="æˆ‘çš„æ–°æµ‹è¯•é¡¹ç›®",
    expected_strategy="docker",
    difficulty="medium",
    expected_time_minutes=8,
    verification=VerificationConfig(
        urls=["http://localhost:3000"],
        expected_status=200
    ),
    tags=["nodejs", "custom"]
)
```

## æµ‹è¯•æµç¨‹

1. **ç¯å¢ƒå‡†å¤‡**ï¼šåˆ›å»ºDockerå®¹å™¨ï¼Œå®‰è£…SSHæœåŠ¡å™¨
2. **é¡¹ç›®éƒ¨ç½²**ï¼šAgentè¿æ¥å®¹å™¨å¹¶æ‰§è¡Œéƒ¨ç½²
3. **ç»“æœéªŒè¯**ï¼šæ£€æŸ¥éƒ¨ç½²çš„åº”ç”¨æ˜¯å¦å¯è®¿é—®
4. **æŒ‡æ ‡æ”¶é›†**ï¼šä»æ—¥å¿—ä¸­æå–å„ç§æŒ‡æ ‡
5. **æŠ¥å‘Šç”Ÿæˆ**ï¼šç”ŸæˆJSONå’ŒMarkdownæ ¼å¼çš„æŠ¥å‘Š

## æµ‹è¯•æŠ¥å‘Š

æµ‹è¯•å®Œæˆåï¼ŒæŠ¥å‘Šä¿å­˜åœ¨`tests/results/reports/`ç›®å½•ï¼š

- `test_report_YYYYMMDD_HHMMSS.json` - JSONæ ¼å¼ï¼ˆæœºå™¨å¯è¯»ï¼‰
- `test_report_YYYYMMDD_HHMMSS.md` - Markdownæ ¼å¼ï¼ˆäººç±»å¯è¯»ï¼‰

### æŠ¥å‘Šå†…å®¹

æŠ¥å‘ŠåŒ…å«ï¼š

- **æ‘˜è¦**ï¼šæ€»æˆåŠŸç‡ã€æŒ‰éš¾åº¦åˆ†ç±»ã€å¹³å‡æŒ‡æ ‡
- **è¯¦ç»†ç»“æœ**ï¼šæ¯ä¸ªé¡¹ç›®çš„è¯¦ç»†æŒ‡æ ‡
- **ç­–ç•¥å‡†ç¡®ç‡**ï¼šAgenté€‰æ‹©æ­£ç¡®ç­–ç•¥çš„æ¯”ä¾‹
- **éªŒè¯é€šè¿‡ç‡**ï¼šéƒ¨ç½²éªŒè¯é€šè¿‡çš„æ¯”ä¾‹

### å…³é”®æŒ‡æ ‡

- **æˆåŠŸç‡**ï¼šéƒ¨ç½²æˆåŠŸçš„é¡¹ç›®æ¯”ä¾‹
- **éƒ¨ç½²æ—¶é—´**ï¼šå®Œæˆéƒ¨ç½²æ‰€éœ€çš„æ—¶é—´
- **è¿­ä»£æ¬¡æ•°**ï¼šAgentçš„å†³ç­–æ¬¡æ•°
- **å‘½ä»¤æ•°**ï¼šæ‰§è¡Œçš„å‘½ä»¤æ€»æ•°
- **ç­–ç•¥å‡†ç¡®ç‡**ï¼šé€‰æ‹©æ­£ç¡®éƒ¨ç½²ç­–ç•¥çš„æ¯”ä¾‹

## æ•…éšœæ’æŸ¥

### Python ç¯å¢ƒä¸ä¸€è‡´

å¦‚æœé‡åˆ° `ModuleNotFoundError: No module named 'dotenv'` æˆ–å…¶ä»–æ¨¡å—æ‰¾ä¸åˆ°çš„é”™è¯¯ï¼Œå¯èƒ½æ˜¯ Python ç¯å¢ƒä¸ä¸€è‡´å¯¼è‡´çš„ã€‚

**Windows å¿«é€Ÿè§£å†³**ï¼š
```powershell
# ä½¿ç”¨ Python Launcherï¼ˆæ¨èï¼‰
py -3.12 -m tests.run_tests --difficulty easy
```

**è¯¦ç»†è§£å†³æ–¹æ¡ˆ**ï¼šè¯·å‚è€ƒ [æ•…éšœæ’æŸ¥æŒ‡å—](../../docs/troubleshooting.md) ä¸­çš„"Python ç¯å¢ƒä¸ä¸€è‡´é—®é¢˜"éƒ¨åˆ†ã€‚

### Dockerè¿æ¥å¤±è´¥

**é”™è¯¯ä¿¡æ¯**ï¼š`Error while fetching server API version: (2, 'CreateFile', 'ç³»ç»Ÿæ‰¾ä¸åˆ°æŒ‡å®šçš„æ–‡ä»¶ã€‚')`

**åŸå› **ï¼šDocker æœªå®‰è£…æˆ–æœªå¯åŠ¨ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **æ£€æŸ¥ Docker æ˜¯å¦å®‰è£…**ï¼š
```powershell
docker version
```

å¦‚æœæç¤ºå‘½ä»¤æ‰¾ä¸åˆ°ï¼Œéœ€è¦å®‰è£… Docker Desktopï¼š
- Windows/Macï¼šä¸‹è½½å¹¶å®‰è£… [Docker Desktop](https://www.docker.com/products/docker-desktop)
- Linuxï¼šå‚è€ƒ [Docker å®˜æ–¹æ–‡æ¡£](https://docs.docker.com/engine/install/)

2. **å¯åŠ¨ Docker Desktop**ï¼ˆWindows/Macï¼‰ï¼š
   - ç¡®ä¿ Docker Desktop å·²å¯åŠ¨
   - ç­‰å¾…ä»»åŠ¡æ å›¾æ ‡å˜ä¸ºç»¿è‰²ï¼ˆè¡¨ç¤º Docker å¼•æ“å·²å°±ç»ªï¼‰

3. **éªŒè¯ Docker è¿è¡ŒçŠ¶æ€**ï¼š
```bash
# æ£€æŸ¥Dockeræ˜¯å¦è¿è¡Œ
docker ps

# æ£€æŸ¥Dockerç‰ˆæœ¬å’Œè¿æ¥
docker info
```

4. **ä¸´æ—¶è·³è¿‡ï¼ˆä»…ç”¨äºæµ‹è¯•ï¼‰**ï¼š
å¦‚æœæš‚æ—¶æ— æ³•å®‰è£… Dockerï¼Œå¯ä»¥ä½¿ç”¨ `--skip-setup` è·³è¿‡ç¯å¢ƒè®¾ç½®ï¼š
```powershell
py -3.12 -m tests.run_tests --skip-setup
```

### SSHè¿æ¥å¤±è´¥

- æ£€æŸ¥å®¹å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œï¼š`docker ps`
- æ£€æŸ¥SSHç«¯å£æ˜¯å¦è¢«å ç”¨
- æŸ¥çœ‹å®¹å™¨æ—¥å¿—ï¼š`docker logs autodep-test-env`

### éƒ¨ç½²å¤±è´¥

- æŸ¥çœ‹Agentæ—¥å¿—ï¼š`agent_logs/deploy_*.json`
- æ£€æŸ¥æµ‹è¯•é¡¹ç›®ä»“åº“æ˜¯å¦å¯è®¿é—®
- éªŒè¯é¡¹ç›®é…ç½®æ˜¯å¦æ­£ç¡®

### è½¯ä»¶æºç½‘ç»œé—®é¢˜

**é”™è¯¯ä¿¡æ¯**ï¼š`502 Bad Gateway` æˆ– `Failed to fetch`

**åŸå› **ï¼šUbuntu å®˜æ–¹è½¯ä»¶æºç½‘ç»œä¸ç¨³å®šæˆ–æ— æ³•è®¿é—®ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šä»£ç å·²è‡ªåŠ¨é…ç½®ä½¿ç”¨å›½å†…é•œåƒæºï¼ˆé˜¿é‡Œäº‘ï¼‰ã€‚å¦‚æœä»æœ‰é—®é¢˜ï¼Œå¯ä»¥ï¼š

1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. é…ç½®ä»£ç†ï¼ˆå¦‚æœåœ¨å…¬å¸ç½‘ç»œå†…ï¼‰
3. æ‰‹åŠ¨æ›´æ¢å…¶ä»–é•œåƒæºï¼ˆå¦‚æ¸…åã€ç½‘æ˜“ï¼‰

### APIè°ƒç”¨å¤±è´¥

- æ£€æŸ¥APIå¯†é’¥æ˜¯å¦æ­£ç¡®è®¾ç½®
- æ£€æŸ¥ç½‘ç»œè¿æ¥
- æŸ¥çœ‹APIé…é¢æ˜¯å¦ç”¨å®Œ

## é…ç½®

é…ç½®æ–‡ä»¶ï¼š`tests/real_deployment/config.json`

å¯ä»¥ä¿®æ”¹ï¼š

- `test_environment`: Dockerç¯å¢ƒé…ç½®
  - `base_image`: åŸºç¡€é•œåƒï¼ˆé»˜è®¤ `ubuntu:22.04`ï¼‰
  - `container_name`: å®¹å™¨åç§°
  - `ssh_password`: SSHå¯†ç 
  - `ssh_timeout`: SSHè¶…æ—¶æ—¶é—´
  - `apt_mirror`: APTé•œåƒæºï¼ˆé»˜è®¤ä½¿ç”¨é˜¿é‡Œäº‘é•œåƒï¼Œå¯é€‰ï¼š`http://mirrors.tuna.tsinghua.edu.cn`ã€`http://mirrors.163.com`ï¼‰
- `deployment`: éƒ¨ç½²è¶…æ—¶ç­‰é…ç½®
- `verification`: éªŒè¯é…ç½®
- `reporting`: æŠ¥å‘Šç”Ÿæˆé…ç½®

## æ³¨æ„äº‹é¡¹

1. **æµ‹è¯•æˆæœ¬**ï¼šæ¯æ¬¡æµ‹è¯•ä¼šæ¶ˆè€—LLM APIè°ƒç”¨ï¼Œæ³¨æ„æˆæœ¬
2. **æµ‹è¯•æ—¶é—´**ï¼šå®Œæ•´æµ‹è¯•å¥—ä»¶å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼ˆå–å†³äºé¡¹ç›®æ•°é‡å’Œå¤æ‚åº¦ï¼‰
3. **ç¯å¢ƒéš”ç¦»**ï¼šæ¯ä¸ªæµ‹è¯•ä½¿ç”¨ç‹¬ç«‹çš„Dockerå®¹å™¨ï¼Œæµ‹è¯•å®Œæˆåè‡ªåŠ¨æ¸…ç†
4. **ç½‘ç»œè¦æ±‚**ï¼šéœ€è¦èƒ½å¤Ÿè®¿é—®GitHubï¼ˆå…‹éš†ä»“åº“ï¼‰å’ŒLLM API

## ç¤ºä¾‹è¾“å‡º

```
ğŸš€ å¼€å§‹çœŸå®éƒ¨ç½²æµ‹è¯•å¥—ä»¶
   ä½¿ç”¨æ¨¡å‹: gemini-2.5-flash
   æµ‹è¯•é¡¹ç›®æ•°: 6

[1/6] æµ‹è¯•é¡¹ç›®: nodejs-express-simple
ğŸ§ª æµ‹è¯•é¡¹ç›®: nodejs-express-simple
   ä»“åº“: https://github.com/test/express-simple.git
   éš¾åº¦: easy
ğŸš€ å¼€å§‹éƒ¨ç½²...
âœ… æµ‹è¯•å®Œæˆ: æˆåŠŸ
âœ… nodejs-express-simple: æˆåŠŸ=True, è€—æ—¶=45.2s, è¿­ä»£=8

...

ğŸ“Š æµ‹è¯•æŠ¥å‘Šå·²ä¿å­˜:
   JSON: tests/results/reports/test_report_20251205_131425.json
   Markdown: tests/results/reports/test_report_20251205_131425.md

============================================================
ğŸ“Š æµ‹è¯•æŠ¥å‘Š
============================================================
æ€»é¡¹ç›®æ•°: 6
æˆåŠŸ: 5 âœ…
å¤±è´¥: 1 âŒ
æˆåŠŸç‡: 83.3%

æŒ‰éš¾åº¦åˆ†ç±»:
  easy: 3/3 (100.0%)
  medium: 2/2 (100.0%)
  hard: 0/1 (0.0%)

å¹³å‡æŒ‡æ ‡ï¼ˆä»…æˆåŠŸé¡¹ç›®ï¼‰:
  éƒ¨ç½²æ—¶é—´: 52.3ç§’
  è¿­ä»£æ¬¡æ•°: 9.2
  å‘½ä»¤æ•°: 12.4
  LLMè°ƒç”¨: 9.2

ç­–ç•¥é€‰æ‹©å‡†ç¡®ç‡: 100.0%
éƒ¨ç½²éªŒè¯é€šè¿‡ç‡: 83.3%
============================================================
```

## è´¡çŒ®

æ·»åŠ æ–°çš„æµ‹è¯•é¡¹ç›®æˆ–æ”¹è¿›æµ‹è¯•å¥—ä»¶ï¼Œè¯·ï¼š

1. åœ¨`test_projects.py`ä¸­æ·»åŠ é¡¹ç›®é…ç½®
2. ç¡®ä¿é¡¹ç›®ä»“åº“å¯å…¬å¼€è®¿é—®
3. æ›´æ–°æœ¬æ–‡æ¡£

