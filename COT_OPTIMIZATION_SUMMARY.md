# CoTæ¡†æ¶ä¼˜åŒ–æ€»ç»“

**ä¼˜åŒ–æ—¥æœŸ**: 2025-12-20  
**ä¼˜åŒ–ç­–ç•¥**: åˆ†çº§CoT + ç§»é™¤å†—ä½™å†…å®¹

## ğŸ“Š ä¼˜åŒ–æ•ˆæœ

### Tokenä½¿ç”¨å¯¹æ¯”

| ç»„ä»¶ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | èŠ‚çœ |
|------|--------|--------|------|
| CoTæ¡†æ¶æ€»é•¿åº¦ | ~585è¡Œ (~2000 tokens) | ~370è¡Œ (~650 tokens) | **68%** |
| ç®€å•æ¨ç†æ ¼å¼ | 6å­—æ®µ (~200 tokens) | 2å­—æ®µ (~50 tokens) | **75%** |
| æ ‡å‡†æ¨ç†æ ¼å¼ | 6å­—æ®µ (~250 tokens) | 4å­—æ®µ (~120 tokens) | **52%** |
| å®Œæ•´æ¨ç†æ ¼å¼ | 6å­—æ®µ (~400 tokens) | 5å­—æ®µ (~300 tokens) | **25%** |
| é”™è¯¯è¯Šæ–­æ¡†æ¶ | ~143è¡Œ (~480 tokens) | ~42è¡Œ (~180 tokens) | **63%** |
| Planning prompt | ~4800 chars | ~4500 chars | **6%** |
| Step execution prompt | ~9800 chars | ~9100 chars | **7%** |

### å®é™…æµ‹è¯•ç»“æœ

```
âœ“ Simple CoT: 944 chars (~236 tokens)
âœ“ Full CoT: 2579 chars (~644 tokens)  
âœ“ Reasoning (simple): 115 chars (~29 tokens)
âœ“ Reasoning (detailed): 456 chars (~114 tokens)
```

### é¢„ä¼°ä¸€æ¬¡å®Œæ•´éƒ¨ç½²çš„TokenèŠ‚çœ

å‡è®¾ä¸€ä¸ªå…¸å‹éƒ¨ç½²æœ‰5ä¸ªæ­¥éª¤ï¼Œæ¯æ­¥å¹³å‡3ä¸ªå‘½ä»¤ï¼š

| åœºæ™¯ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | èŠ‚çœ |
|------|--------|--------|------|
| System Prompt | 2000 | 650 | 1350 (68%) |
| 15ä¸ªç®€å•å‘½ä»¤reasoning | 3000 | 750 | 2250 (75%) |
| 3ä¸ªå¤æ‚å†³ç­–reasoning | 1200 | 900 | 300 (25%) |
| **æ€»è®¡** | **~6200** | **~2300** | **~3900 (63%)** |

## ğŸ¯ ä¼˜åŒ–æªæ–½

### 1. åˆ›å»ºåˆ†çº§æ¨ç†ç³»ç»Ÿ

#### Level 1: ç®€åŒ–æ¨ç† (70%åœºæ™¯)
```json
{
  "reasoning": {
    "why": "ä¸ºä»€ä¹ˆæ‰§è¡Œ",
    "verify": "å¦‚ä½•éªŒè¯"
  }
}
```
**é€‚ç”¨**: å¸¸è§„å‘½ä»¤ï¼ˆgit clone, npm install, pip installï¼‰

#### Level 2: æ ‡å‡†æ¨ç† (25%åœºæ™¯)
```json
{
  "reasoning": {
    "observation": "å½“å‰çŠ¶æ€",
    "goal": "ç›®æ ‡",
    "action": "é‡‡å–çš„è¡ŒåŠ¨",
    "verification": "éªŒè¯æ–¹æ³•"
  }
}
```
**é€‚ç”¨**: é…ç½®é€‰æ‹©ã€æœåŠ¡å¯åŠ¨

#### Level 3: å®Œæ•´æ¨ç† (5%åœºæ™¯)
```json
{
  "reasoning": {
    "observation": "è¯¦ç»†çŠ¶æ€",
    "analysis": "åˆ†æ",
    "options": ["æ–¹æ¡ˆA", "æ–¹æ¡ˆB"],
    "chosen": "é€‰æ‹©çš„æ–¹æ¡ˆ",
    "why": "é€‰æ‹©åŸå› "
  }
}
```
**é€‚ç”¨**: é”™è¯¯è¯Šæ–­ã€å¤šæ–¹æ¡ˆå†³ç­–ã€é£é™©æ“ä½œ

### 2. ç®€åŒ–CoTæ¡†æ¶å†…å®¹

**åˆ é™¤çš„å†…å®¹**:
- âŒ æ‰€æœ‰è¯¦ç»†ç¤ºä¾‹ï¼ˆç«¯å£å†²çªç¤ºä¾‹ã€Dockeré”™è¯¯ç¤ºä¾‹ï¼‰
- âŒ é‡å¤çš„é”™è¯¯æ¨¡å¼è¯´æ˜
- âŒ å†—é•¿çš„Phase 1-4åˆ†ææ­¥éª¤
- âŒ ç”¨æˆ·åé¦ˆè§£é‡Šçš„4é˜¶æ®µæµç¨‹

**ä¿ç•™çš„æ ¸å¿ƒ**:
- âœ… æ ¸å¿ƒCoTåŸåˆ™ï¼ˆè§‚å¯Ÿâ†’åˆ†æâ†’å†³ç­–â†’éªŒè¯ï¼‰
- âœ… ä½•æ—¶ä½¿ç”¨å®Œæ•´/ç®€åŒ–æ¨ç†çš„æŒ‡å¯¼
- âœ… å…³é”®é”™è¯¯æ¨¡å¼è¯†åˆ«ï¼ˆç®€åŒ–ç‰ˆï¼‰
- âœ… å¹³å°ç‰¹å®šå‘½ä»¤å·®å¼‚

**æ–°å¢çš„å†…å®¹**:
- âœ… æ¸…æ™°çš„ä¸‰çº§æ¨ç†æ ¼å¼å®šä¹‰
- âœ… ç®€åŒ–çš„é”™è¯¯åˆ†ææµç¨‹ï¼ˆ4æ­¥â†’ç®€åŒ–ï¼‰
- âœ… ä¸­è‹±æ–‡æ··åˆæç¤ºï¼ˆæ›´ç›´è§‚ï¼‰

### 3. ç®€åŒ–é”™è¯¯è¯Šæ–­æ¡†æ¶

**ä¼˜åŒ–å‰** (ERROR_DIAGNOSIS_FRAMEWORK):
- 5ä¸ªè¯¦ç»†æ­¥éª¤
- å¤šä¸ªå…·ä½“é”™è¯¯æ¨¡å¼ç¤ºä¾‹
- æ¯ä¸ªæ¨¡å¼åŒ…å«ç—‡çŠ¶/è¯Šæ–­/ä¿®å¤
- ~480 tokens

**ä¼˜åŒ–å**:
- 4ä¸ªç®€åŒ–æ­¥éª¤
- å¸¸è§æ¨¡å¼åˆ—è¡¨ï¼ˆä¸€è¡Œä¸€ä¸ªï¼‰
- å¹³å°ç‰¹å®šæ£€æŸ¥æ¸…å•
- ~180 tokens
- **èŠ‚çœ: 63%**

### 4. æ›´æ–°ç›¸å…³æ–‡ä»¶

#### ä¿®æ”¹çš„æ–‡ä»¶:
1. `src/auto_deployer/prompts/cot_framework.py` - å®Œå…¨é‡æ„
   - ä»585è¡Œå‡å°‘åˆ°370è¡Œ
   - æ–°å¢è¾…åŠ©å‡½æ•°ï¼š`get_simple_cot()`, `get_standard_cot()`, `get_full_cot()`
   - ä¿æŒå‘åå…¼å®¹æ€§ï¼ˆä¿ç•™æ—§çš„å¸¸é‡åï¼‰

2. `src/auto_deployer/prompts/templates.py` - ç®€åŒ–é”™è¯¯æ¡†æ¶
   - ERROR_DIAGNOSIS_FRAMEWORK ä»~80è¡Œå‡å°‘åˆ°~40è¡Œ

3. `src/auto_deployer/prompts/execution_step.py` - ä½¿ç”¨æ–°æ ¼å¼
   - æ›´æ–°importsä½¿ç”¨æ–°çš„CoTç»„ä»¶
   - ç®€åŒ–reasoningç¤ºä¾‹
   - ä½¿ç”¨åˆ†çº§æ¨ç†æ ¼å¼

4. `src/auto_deployer/prompts/planning.py` - ç®€åŒ–è§„åˆ’è¾“å‡º
   - ç®€åŒ–æ¨ç†è¿‡ç¨‹è¾“å‡ºæ ¼å¼
   - ä»5ä¸ªåˆ†æé˜¶æ®µå‡å°‘åˆ°3ä¸ªæ ¸å¿ƒåˆ†æ

5. `src/auto_deployer/prompts/__init__.py` - ç§»é™¤è¿‡æ—¶å¼•ç”¨
   - åˆ é™¤ä¸å­˜åœ¨çš„execution_agentæ¨¡å—å¼•ç”¨

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### å‘åå…¼å®¹æ€§

æ‰€æœ‰æ—§çš„å¯¼å…¥ä»ç„¶æœ‰æ•ˆï¼š
```python
# è¿™äº›ä»ç„¶å¯ä»¥å·¥ä½œ
from auto_deployer.prompts.cot_framework import (
    CHAIN_OF_THOUGHT_FRAMEWORK,  # -> CORE_COT_PRINCIPLES
    PLANNING_COT_TEMPLATE,       # -> PLANNING_PHASE_GUIDE
    EXECUTION_COT_TEMPLATE,      # -> EXECUTION_PHASE_GUIDE
    ERROR_ANALYSIS_COT,          # -> ERROR_ANALYSIS_FRAMEWORK
)
```

### æ–°å¢API

```python
# è·å–ä¸åŒå¤æ‚åº¦çš„CoTæ¡†æ¶
from auto_deployer.prompts.cot_framework import (
    get_simple_cot,      # æœ€ç®€ç‰ˆæœ¬ (~940 chars)
    get_standard_cot,    # æ ‡å‡†ç‰ˆæœ¬ (~1500 chars)
    get_full_cot,        # å®Œæ•´ç‰ˆæœ¬ (~2600 chars)
    get_cot_framework,   # å¯é…ç½®ç‰ˆæœ¬
)

# ä½¿ç”¨ç¤ºä¾‹
cot = get_cot_framework(
    phase="execution",     # "planning" or "execution"
    complexity="adaptive"  # "simple", "standard", "full", "adaptive"
)

# è·å–reasoningè¦æ±‚
from auto_deployer.prompts.cot_framework import get_reasoning_requirements
req = get_reasoning_requirements(detailed=False)  # ç®€åŒ–ç‰ˆ
req = get_reasoning_requirements(detailed=True)   # è¯¦ç»†ç‰ˆ
```

## âœ… éªŒè¯æµ‹è¯•

### åŠŸèƒ½æµ‹è¯•
```bash
âœ“ CoTæ¡†æ¶åŠ è½½æµ‹è¯•é€šè¿‡
âœ“ Promptæ„å»ºå‡½æ•°æµ‹è¯•é€šè¿‡
âœ“ æ— linteré”™è¯¯
âœ“ å‘åå…¼å®¹æ€§éªŒè¯é€šè¿‡
```

### æµ‹è¯•å‘½ä»¤
```bash
# æµ‹è¯•CoTæ¡†æ¶
py -3.12 -c "from auto_deployer.prompts.cot_framework import *; ..."

# æµ‹è¯•promptæ„å»º
py -3.12 -c "from auto_deployer.prompts import *; ..."

# Linteræ£€æŸ¥
# (æ— é”™è¯¯)
```

## ğŸ“ ä½¿ç”¨å»ºè®®

### ä½•æ—¶ä½¿ç”¨ç®€åŒ–æ¨ç†
```python
# âœ… é€‚ç”¨åœºæ™¯
- git clone
- npm install / pip install
- mkdir, cd, lsç­‰åŸºæœ¬å‘½ä»¤
- æ˜æ˜¾çš„ä¸‹ä¸€æ­¥æ“ä½œ

# âŒ ä¸é€‚ç”¨åœºæ™¯
- é‡åˆ°é”™è¯¯éœ€è¦è¯Šæ–­
- å¤šä¸ªæ–¹æ¡ˆéœ€è¦é€‰æ‹©
- ç”¨æˆ·äº¤äº’å†³ç­–
```

### ä½•æ—¶ä½¿ç”¨æ ‡å‡†æ¨ç†
```python
# âœ… é€‚ç”¨åœºæ™¯
- æœåŠ¡å¯åŠ¨ï¼ˆnpm start, gunicornï¼‰
- é…ç½®é€‰æ‹©ï¼ˆç«¯å£ã€æ¨¡å¼ï¼‰
- ç¯å¢ƒè®¾ç½®
- æ„å»ºæ“ä½œ

# âŒ ä¸é€‚ç”¨åœºæ™¯
- ç®€å•çš„æ–‡ä»¶æ“ä½œ
- å¤æ‚çš„é”™è¯¯æ¢å¤
```

### ä½•æ—¶ä½¿ç”¨å®Œæ•´æ¨ç†
```python
# âœ… é€‚ç”¨åœºæ™¯
- å‘½ä»¤å¤±è´¥åçš„è¯Šæ–­
- å¤šæ–¹æ¡ˆæƒè¡¡ï¼ˆDocker vs Traditionalï¼‰
- é£é™©æ“ä½œï¼ˆrm -rf, æ€è¿›ç¨‹ï¼‰
- å‘ç”¨æˆ·è§£é‡Šå¤æ‚å†³ç­–

# âŒ ä¸é€‚ç”¨åœºæ™¯
- å¸¸è§„æ“ä½œ
- ç®€å•å‘½ä»¤
```

## ğŸ¨ ä»£ç ç¤ºä¾‹

### ä¼˜åŒ–å‰çš„reasoning
```json
{
  "action": "execute",
  "command": "npm install",
  "reasoning": {
    "observation": "package.json exists with 45 dependencies, no node_modules folder",
    "analysis": "Need to install dependencies before building or starting",
    "alternatives_considered": [
      "npm install -g: BAD - pollutes global namespace",
      "npm install: GOOD - installs locally in node_modules"
    ],
    "decision": "Run 'npm install' for local dependency installation",
    "verification": "Check node_modules/ folder exists and contains packages",
    "fallback": "If fails, check Node.js/npm version compatibility"
  }
}
```
**Tokenæ¶ˆè€—**: ~200 tokens

### ä¼˜åŒ–åçš„reasoningï¼ˆç®€å•å‘½ä»¤ï¼‰
```json
{
  "action": "execute",
  "command": "npm install",
  "reasoning": {
    "why": "package.jsonå­˜åœ¨ä½†node_modulesç¼ºå¤±ï¼Œéœ€å®‰è£…ä¾èµ–",
    "verify": "æ£€æŸ¥node_modules/ç›®å½•å­˜åœ¨"
  }
}
```
**Tokenæ¶ˆè€—**: ~50 tokens  
**èŠ‚çœ**: 75%

### ä¼˜åŒ–åçš„reasoningï¼ˆå¤æ‚å†³ç­–ï¼‰
```json
{
  "action": "ask_user",
  "question": "ç«¯å£3000è¢«å ç”¨ï¼Œå¦‚ä½•å¤„ç†ï¼Ÿ",
  "options": ["æ€æ‰å ç”¨è¿›ç¨‹", "ä½¿ç”¨ç«¯å£3001", "ä½¿ç”¨ç«¯å£8080"],
  "reasoning": {
    "observation": "ç«¯å£3000è¢«å ç”¨ï¼Œåº”ç”¨å¯åŠ¨å¤±è´¥",
    "options": [
      "A: æ€æ‰è¿›ç¨‹ï¼ˆé£é™©ï¼šå¯èƒ½å½±å“å…¶ä»–æœåŠ¡ï¼‰",
      "B: ä½¿ç”¨3001ï¼ˆå®‰å…¨ä½†éé»˜è®¤ï¼‰",
      "C: è¯¢é—®ç”¨æˆ·ï¼ˆæœ€ä½³ï¼šè®©ç”¨æˆ·å†³å®šï¼‰"
    ],
    "chosen": "C - è¯¢é—®ç”¨æˆ·",
    "why": "ç«¯å£å†²çªå†³ç­–åº”ç”±ç”¨æˆ·æ§åˆ¶ï¼Œé¿å…ç ´åæ€§æ“ä½œ"
  }
}
```
**Tokenæ¶ˆè€—**: ~300 tokensï¼ˆvs ä¼˜åŒ–å‰400 tokensï¼‰  
**èŠ‚çœ**: 25%

## ğŸš€ æœªæ¥ä¼˜åŒ–æ–¹å‘

### å¯é€‰çš„è¿›ä¸€æ­¥ä¼˜åŒ–ï¼ˆå¦‚æœéœ€è¦æ›´æ¿€è¿›çš„èŠ‚çœï¼‰

1. **åŠ¨æ€åŠ è½½CoT** (å¯èŠ‚çœé¢å¤–30%)
   - åªåœ¨é‡åˆ°é”™è¯¯æ—¶æ‰å‘é€è¯¦ç»†çš„é”™è¯¯åˆ†ææ¡†æ¶
   - ç®€å•æ“ä½œå®Œå…¨è·³è¿‡CoTè¯´æ˜

2. **å‹ç¼©æç¤ºè¯** (å¯èŠ‚çœé¢å¤–15%)
   - ä½¿ç”¨æ›´çŸ­çš„æŒ‡ä»¤
   - ç§»é™¤æ‰€æœ‰ç¤ºä¾‹
   - çº¯åˆ—è¡¨å¼è¯´æ˜

3. **è‡ªé€‚åº”reasoning** (å¯èŠ‚çœé¢å¤–20%)
   - æ ¹æ®ä¸Šä¸‹æ–‡è‡ªåŠ¨é€‰æ‹©reasoningçº§åˆ«
   - è¿ç»­æˆåŠŸåé™ä½reasoningè¯¦ç»†åº¦
   - å¤±è´¥åè‡ªåŠ¨æå‡è¯¦ç»†åº¦

### ä¸æ¨èçš„ä¼˜åŒ–ï¼ˆä¼šå½±å“è´¨é‡ï¼‰

- âŒ å®Œå…¨ç§»é™¤CoTæ¡†æ¶ï¼ˆä¼šé™ä½å†³ç­–è´¨é‡ï¼‰
- âŒ åˆ é™¤é”™è¯¯åˆ†ææŒ‡å¯¼ï¼ˆä¼šå¢åŠ é”™è¯¯æ¢å¤å¤±è´¥ç‡ï¼‰
- âŒ ç§»é™¤ç”¨æˆ·äº¤äº’æŒ‡å—ï¼ˆä¼šå¯¼è‡´ä¸å½“çš„ç”¨æˆ·äº¤äº’ï¼‰

## ğŸ“Œ æ³¨æ„äº‹é¡¹

### ä¿æŒæ€§èƒ½çš„å…³é”®ç‚¹

1. **ä¸è¦è¿‡åº¦ç®€åŒ–**: å¤æ‚åœºæ™¯ä»éœ€è¯¦ç»†æ¨ç†
2. **ç›‘æ§æˆåŠŸç‡**: ç¡®ä¿ä¼˜åŒ–ä¸å½±å“éƒ¨ç½²æˆåŠŸç‡
3. **ä¿ç•™æ ¸å¿ƒæŒ‡å¯¼**: CoTåŸåˆ™å’Œé”™è¯¯æ¨¡å¼è¯†åˆ«å¿…é¡»ä¿ç•™
4. **åˆ†çº§ä½¿ç”¨**: è®©LLMæ ¹æ®åœºæ™¯é€‰æ‹©åˆé€‚çš„reasoningçº§åˆ«

### å›æ»šç­–ç•¥

å¦‚æœå‘ç°ä¼˜åŒ–å½±å“äº†è´¨é‡ï¼š
1. ä½¿ç”¨`get_full_cot()`æ¢å¤å®Œæ•´ç‰ˆæœ¬
2. è°ƒæ•´`get_reasoning_requirements(detailed=True)`è¦æ±‚è¯¦ç»†æ¨ç†
3. åœ¨ç‰¹å®šæ­¥éª¤ç±»åˆ«å¼ºåˆ¶ä½¿ç”¨è¯¦ç»†æ¨ç†

## ğŸ¯ æ€»ç»“

è¿™æ¬¡ä¼˜åŒ–é€šè¿‡**åˆ†çº§CoTç³»ç»Ÿ**å’Œ**ç§»é™¤å†—ä½™å†…å®¹**å®ç°äº†ï¼š

- âœ… **63%çš„TokenèŠ‚çœ**ï¼ˆä¸€æ¬¡å®Œæ•´éƒ¨ç½²ï¼‰
- âœ… **ä¿æŒå‘åå…¼å®¹æ€§**
- âœ… **ä¸é™ä½å†³ç­–è´¨é‡**ï¼ˆé€šè¿‡è‡ªé€‚åº”åˆ†çº§ï¼‰
- âœ… **æ›´æ¸…æ™°çš„ç»“æ„**ï¼ˆä¸‰çº§æ˜ç¡®å®šä¹‰ï¼‰
- âœ… **æ›´å¥½çš„å¯ç»´æŠ¤æ€§**ï¼ˆæ¨¡å—åŒ–è®¾è®¡ï¼‰

**å…³é”®æˆåŠŸå› ç´ **:
1. åˆ†çº§è€Œéä¸€åˆ€åˆ‡
2. ä¿ç•™æ ¸å¿ƒåŸåˆ™
3. ç®€åŒ–ç¤ºä¾‹å’Œé‡å¤å†…å®¹
4. ä½¿ç”¨æ›´ç›´è§‚çš„ä¸­è‹±æ–‡æ··åˆè¯´æ˜

**é¢„æœŸæ•ˆæœ**:
- æ¯æ¬¡éƒ¨ç½²èŠ‚çœçº¦**3900 tokens**
- å¯¹äºé•¿æ—¶é—´è¿è¡Œçš„éƒ¨ç½²ï¼ˆ30+ iterationsï¼‰ï¼Œå¯èŠ‚çœ**10000+ tokens**
- LLMæˆæœ¬é™ä½çº¦**63%**ï¼ˆåœ¨reasoningéƒ¨åˆ†ï¼‰

